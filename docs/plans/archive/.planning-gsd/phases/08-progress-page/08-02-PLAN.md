---
phase: 08-progress-page
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/app/api/progress/activity-feed/route.ts
  - src/components/features/progress/activity-feed.tsx
  - src/components/features/progress/progress-trend-chart.tsx
  - src/app/(dashboard)/progress/page.tsx
autonomous: true

must_haves:
  truths:
    - "Activity feed shows recent KPI completions with timestamps"
    - "Trend chart shows progress over time with selectable ranges"
    - "Activity includes KPI title, level, vision context"
  artifacts:
    - path: "src/app/api/progress/activity-feed/route.ts"
      provides: "Recent completions endpoint"
    - path: "src/components/features/progress/activity-feed.tsx"
      provides: "Chronological activity list"
    - path: "src/components/features/progress/progress-trend-chart.tsx"
      provides: "Recharts line/bar chart for trends"
---

<objective>
Add activity feed and trend charts to the Progress page to fulfill PRGS-02 and PRGS-03 requirements.

Purpose: Show users recent progress activity and trends over time for motivation and analysis.

Output: Progress page with activity feed and trend charts.
</objective>

<context>
@.planning/phases/08-progress-page/08-GAP-ANALYSIS.md
@src/app/api/vision-activity/route.ts
@src/app/(dashboard)/progress/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create activity feed API</name>
  <files>src/app/api/progress/activity-feed/route.ts</files>
  <action>
Create endpoint to fetch recent KPI completions.

1. **Query kpi_logs table:**
   - Order by created_at DESC
   - Limit to 50 most recent
   - Filter by is_completed = true

2. **Join with vision_kpis:**
   - Get title, level, vision_id

3. **Join with visions:**
   - Get vision title and color

4. **Response format:**
   ```typescript
   interface ActivityItem {
     id: string;
     kpiId: string;
     kpiTitle: string;
     level: string;
     visionId: string;
     visionTitle: string;
     visionColor: string;
     completedAt: string;
     value?: number;
   }
   ```

5. **Support query params:**
   - visionId: filter by vision
   - limit: number of items (default 50)
  </action>
  <verify>
API returns recent activity with all required fields.
  </verify>
  <done>Activity feed API returns recent KPI completions.</done>
</task>

<task type="auto">
  <name>Task 2: Create ActivityFeed component</name>
  <files>src/components/features/progress/activity-feed.tsx</files>
  <action>
Create component to display recent activity.

1. **Fetch from activity feed API:**
   - Use React Query for caching
   - Poll or refetch periodically

2. **Display each item:**
   - KPI title with level badge (daily/weekly/monthly/quarterly)
   - Vision color indicator and name
   - Relative timestamp (e.g., "2 hours ago")
   - CheckCircle icon for visual

3. **Group by date:**
   - Today, Yesterday, This Week, Earlier

4. **Empty state:**
   - "No recent activity" message
   - Link to Today page to complete KPIs

5. **Loading state:**
   - Skeleton loaders
  </action>
  <verify>
Component displays activity items with correct formatting.
  </verify>
  <done>ActivityFeed shows recent completions grouped by date.</done>
</task>

<task type="auto">
  <name>Task 3: Create ProgressTrendChart component</name>
  <files>src/components/features/progress/progress-trend-chart.tsx</files>
  <action>
Create Recharts-based trend chart.

1. **Fetch from vision-activity API:**
   - Get composite scores over time
   - Filter based on date range

2. **Date range selector:**
   - 7 days, 30 days, 90 days, 365 days

3. **Chart configuration:**
   - Line chart for score trend
   - Bar chart for daily completions
   - Area fill for visual appeal

4. **Tooltip:**
   - Show date
   - Show score and breakdown

5. **Responsive design:**
   - ResponsiveContainer from Recharts
   - Adjust for mobile widths
  </action>
  <verify>
Chart renders with correct data and interactions.
  </verify>
  <done>ProgressTrendChart displays progress over time.</done>
</task>

<task type="auto">
  <name>Task 4: Integrate into Progress page</name>
  <files>src/app/(dashboard)/progress/page.tsx</files>
  <action>
Add activity feed and trend chart to Progress page.

1. **Layout options:**
   - Add as new tab: "Activity" / "Trends"
   - Or add as sidebar cards
   - Or add as sections below main content

2. **Recommended layout:**
   - Trend chart at top (full width card)
   - Activity feed in sidebar (replace or add to existing)

3. **Connect to filters:**
   - Vision filter affects activity feed
   - Date range filter affects trend chart
  </action>
  <verify>
Progress page shows activity feed and trend chart.
  </verify>
  <done>Progress page has activity and trend sections.</done>
</task>

</tasks>

<verification>
1. Activity feed shows recent completions
2. Each item shows KPI title, level, vision, timestamp
3. Trend chart renders with correct data
4. Date range selector changes chart data
5. Vision filter affects displayed data
</verification>

<success_criteria>
- PRGS-02: Activity feed shows recent completions
- PRGS-03: Trend chart shows progress over time
- Data refreshes appropriately
- Responsive design works
</success_criteria>

<output>
After completion, create 08-02-SUMMARY.md with implementation notes.
</output>
