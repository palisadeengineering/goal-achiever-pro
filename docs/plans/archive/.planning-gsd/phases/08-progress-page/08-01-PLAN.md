---
phase: 08-progress-page
plan: 01
type: execute
wave: 1
depends_on: ["07-01"]
files_modified:
  - src/app/(dashboard)/progress/page.tsx
  - src/components/features/progress/hierarchy-rollup-view.tsx
  - src/components/features/progress/progress-filters.tsx
autonomous: true

must_haves:
  truths:
    - "Progress page shows Vision -> Quarter -> Month -> Week -> Day roll-up"
    - "Each level displays progress percentage and status indicator"
    - "User can filter by vision, status, and date range"
  artifacts:
    - path: "src/components/features/progress/hierarchy-rollup-view.tsx"
      provides: "Visual hierarchy with nested progress bars"
    - path: "src/components/features/progress/progress-filters.tsx"
      provides: "Filter controls for vision, status, date range"
---

<objective>
Add roll-up visualization and filter controls to the Progress page to fulfill PRGS-01 and PRGS-05 requirements.

Purpose: Allow users to see how daily actions cascade up to vision-level progress and filter to focus on specific areas.

Output: Progress page with hierarchical view and working filters.
</objective>

<context>
@.planning/phases/08-progress-page/08-GAP-ANALYSIS.md
@src/app/(dashboard)/progress/page.tsx
@src/lib/hooks/use-goal-tree.ts
@src/components/features/kpi/goal-tree-view.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HierarchyRollupView component</name>
  <files>src/components/features/progress/hierarchy-rollup-view.tsx</files>
  <action>
Create a component that visualizes the goal hierarchy with roll-up progress.

1. **Fetch data using existing useGoalTree hook:**
   ```typescript
   interface HierarchyRollupViewProps {
     visionId: string;
     visionTitle: string;
     visionColor: string;
   }
   ```

2. **Display hierarchy levels:**
   - Vision level (root) with overall progress
   - Quarterly level (children with timeframe='quarterly')
   - Monthly level (grandchildren with timeframe='monthly')
   - Weekly level (with timeframe='weekly')
   - Daily level (leaves with timeframe='daily')

3. **Visual design:**
   - Nested progress bars with indentation
   - Color-coded status indicators (on-track/at-risk/behind)
   - Progress percentage on right side
   - Collapsible sections for each level
   - Use existing StatusIndicator component

4. **Aggregate progress at each level:**
   - Vision: Average of quarterly progress
   - Quarterly: Average of monthly progress
   - And so on down the chain
  </action>
  <verify>
Component renders hierarchy with progress bars.
  </verify>
  <done>HierarchyRollupView shows goal hierarchy with progress roll-up.</done>
</task>

<task type="auto">
  <name>Task 2: Create ProgressFilters component</name>
  <files>src/components/features/progress/progress-filters.tsx</files>
  <action>
Create filter controls for the Progress page.

1. **Filter state interface:**
   ```typescript
   interface ProgressFilters {
     visionId: string | null;
     status: 'all' | 'on-track' | 'at-risk' | 'behind';
     dateRange: 'all' | 'this-quarter' | 'this-month' | 'this-week';
   }
   ```

2. **Vision selector:**
   - Dropdown with all user's visions
   - "All Visions" option
   - Color indicator for each vision

3. **Status filter:**
   - Radio/segment buttons: All, On Track, At Risk, Behind

4. **Date range selector:**
   - Dropdown: All Time, This Quarter, This Month, This Week

5. **Props:**
   ```typescript
   interface ProgressFiltersProps {
     filters: ProgressFilters;
     onFiltersChange: (filters: ProgressFilters) => void;
     visions: { id: string; title: string; color: string }[];
   }
   ```
  </action>
  <verify>
Filter controls render and trigger onChange callbacks.
  </verify>
  <done>ProgressFilters provides vision, status, and date range filtering.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into Progress page</name>
  <files>src/app/(dashboard)/progress/page.tsx</files>
  <action>
Add the new components to the Progress page.

1. **Add filter state:**
   ```typescript
   const [filters, setFilters] = useState<ProgressFilters>({
     visionId: null,
     status: 'all',
     dateRange: 'all',
   });
   ```

2. **Add filters to header:**
   - Place ProgressFilters in PageHeader actions area
   - Or below header as a filter bar

3. **Add HierarchyRollupView section:**
   - New tab or section called "Hierarchy View"
   - Or replace existing "KPIs by Vision" with enhanced view

4. **Filter the data:**
   - Apply visionId filter to kpisByVision
   - Apply status filter to hide/show based on progress
   - Date range affects which KPIs are considered "active"

5. **Maintain existing functionality:**
   - Keep streak leaderboard
   - Keep summary stats
   - Keep quick links
  </action>
  <verify>
Progress page shows filters and hierarchy view.
  </verify>
  <done>Progress page integrated with roll-up view and filters.</done>
</task>

</tasks>

<verification>
1. Navigate to /progress page
2. Verify hierarchy roll-up shows Vision -> Quarterly -> Monthly -> Weekly -> Daily
3. Each level shows progress percentage
4. Status indicators (green/yellow/red) display correctly
5. Vision filter filters the displayed data
6. Status filter hides items not matching status
7. Collapsible sections work for each level
</verification>

<success_criteria>
- PRGS-01: Roll-up visualization shows full hierarchy
- PRGS-05: Filters work for vision, status, date range
- Existing Progress page functionality preserved
- Responsive design for mobile
</success_criteria>

<output>
After completion, create 08-01-SUMMARY.md with implementation notes.
</output>
