---
phase: 08-progress-page
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/app/api/progress/summary/route.ts
  - src/components/features/progress/zombie-goals-widget.tsx
  - src/components/features/progress/impact-indicators.tsx
  - src/app/(dashboard)/progress/page.tsx
autonomous: true

must_haves:
  truths:
    - "Zombie goals with no activity in 14+ days are flagged"
    - "Impact indicators show which daily KPIs drive vision progress"
    - "User can take action on zombie goals (revive or archive)"
  artifacts:
    - path: "src/components/features/progress/zombie-goals-widget.tsx"
      provides: "List of stale goals with action buttons"
    - path: "src/components/features/progress/impact-indicators.tsx"
      provides: "Top impact daily KPIs display"
---

<objective>
Add zombie goal detection and impact indicators to the Progress page to fulfill PRGS-04 and PRGS-06 requirements.

Purpose: Help users identify neglected goals and understand which daily actions have the most impact on their vision progress.

Output: Progress page with zombie goals widget and impact ranking.
</objective>

<context>
@.planning/phases/08-progress-page/08-GAP-ANALYSIS.md
@src/app/api/progress/summary/route.ts
@src/app/(dashboard)/progress/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance progress summary API for zombie detection</name>
  <files>src/app/api/progress/summary/route.ts</files>
  <action>
Add zombie goal detection to the progress summary endpoint.

1. **Query kpi_logs for last activity:**
   ```sql
   SELECT kpi_id, MAX(log_date) as last_activity
   FROM kpi_logs
   WHERE user_id = ?
   GROUP BY kpi_id
   ```

2. **Calculate days since last activity:**
   - Compare last_activity to today
   - Flag as zombie if > 14 days

3. **Include in response:**
   ```typescript
   zombieGoals: {
     id: string;
     title: string;
     level: string;
     visionTitle: string;
     visionColor: string;
     daysSinceActivity: number;
     lastActivity: string | null;
   }[]
   ```

4. **Sort by daysSinceActivity DESC:**
   - Most neglected first
  </action>
  <verify>
API returns zombieGoals array with correct data.
  </verify>
  <done>Progress summary API includes zombie goal detection.</done>
</task>

<task type="auto">
  <name>Task 2: Create ZombieGoalsWidget component</name>
  <files>src/components/features/progress/zombie-goals-widget.tsx</files>
  <action>
Create widget to display and manage zombie goals.

1. **Display each zombie goal:**
   - KPI title
   - Level badge
   - Vision color indicator
   - "X days inactive" badge (red)
   - Last activity date

2. **Action buttons:**
   - "Revive" - navigate to log the KPI
   - "Archive" - mark as inactive

3. **Visual design:**
   - Ghost/skull icon for header
   - Warning color scheme (yellow/orange)
   - Card with list of items

4. **Empty state:**
   - "No zombie goals - great job!" with celebration icon

5. **Limit display:**
   - Show top 5 most neglected
   - "View all" link if more exist
  </action>
  <verify>
Widget displays zombie goals with action buttons.
  </verify>
  <done>ZombieGoalsWidget shows stale goals with actions.</done>
</task>

<task type="auto">
  <name>Task 3: Create ImpactIndicators component</name>
  <files>src/components/features/progress/impact-indicators.tsx</files>
  <action>
Create component showing which daily KPIs have highest impact.

1. **Calculate impact score:**
   - Based on weight path to vision
   - Daily KPI weight * parent weight * ... = impact score
   - Higher score = higher impact

2. **Fetch from goal tree:**
   - Use useGoalTree hook
   - Traverse tree to find daily KPIs
   - Calculate path weights

3. **Display top impact KPIs:**
   - Title with impact badge (High/Medium/Low)
   - Vision it contributes to
   - Current streak (if any)

4. **Impact badge colors:**
   - High: Green/emerald
   - Medium: Blue/cyan
   - Low: Gray

5. **Limit display:**
   - Top 5 highest impact daily KPIs
  </action>
  <verify>
Component displays KPIs ranked by impact.
  </verify>
  <done>ImpactIndicators shows top impact daily KPIs.</done>
</task>

<task type="auto">
  <name>Task 4: Integrate into Progress page</name>
  <files>src/app/(dashboard)/progress/page.tsx</files>
  <action>
Add zombie goals and impact indicators to Progress page.

1. **Add ZombieGoalsWidget:**
   - In sidebar area
   - Below streak leaderboard
   - Or as alert banner if any zombies exist

2. **Add ImpactIndicators:**
   - In sidebar area
   - Or as a new section
   - Title: "Top Impact Actions"

3. **Connect to data:**
   - Use existing progress summary API (enhanced)
   - Use useGoalTree for impact calculation

4. **Conditional display:**
   - Only show ZombieGoalsWidget if zombies exist
   - Always show ImpactIndicators if daily KPIs exist
  </action>
  <verify>
Progress page shows zombie goals and impact indicators.
  </verify>
  <done>Progress page integrated with goal health features.</done>
</task>

</tasks>

<verification>
1. Zombie goals widget shows KPIs with no activity in 14+ days
2. "Revive" button navigates to log the KPI
3. Impact indicators show highest-impact daily KPIs
4. Impact scoring reflects weight hierarchy
5. Empty states display correctly
</verification>

<success_criteria>
- PRGS-04: Zombie goals flagged after 14 days inactivity
- PRGS-06: Impact indicators show high-impact daily actions
- Actions work (revive, archive)
- Responsive design
</success_criteria>

<output>
After completion, create 08-03-SUMMARY.md and update STATE.md to mark Phase 8 complete.
</output>
