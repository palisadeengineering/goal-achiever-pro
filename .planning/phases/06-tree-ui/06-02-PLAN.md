---
phase: 06-tree-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/breadcrumb.tsx
  - src/components/features/kpi/status-indicator.tsx
  - src/components/features/kpi/goal-tree-breadcrumb.tsx
autonomous: true

must_haves:
  truths:
    - "Status indicators use icon+color for accessibility (WCAG 1.4.1)"
    - "Breadcrumb shows path from Vision to selected node"
    - "Clicking breadcrumb item navigates to that node"
    - "Status indicator variants cover all KPI statuses"
  artifacts:
    - path: "src/components/ui/breadcrumb.tsx"
      provides: "shadcn/ui Breadcrumb component"
      exports: ["Breadcrumb", "BreadcrumbList", "BreadcrumbItem", "BreadcrumbLink", "BreadcrumbPage", "BreadcrumbSeparator"]
    - path: "src/components/features/kpi/status-indicator.tsx"
      provides: "Accessible status badge with icon+color"
      exports: ["StatusIndicator", "statusConfig"]
    - path: "src/components/features/kpi/goal-tree-breadcrumb.tsx"
      provides: "Breadcrumb navigation for goal tree"
      exports: ["GoalTreeBreadcrumb", "deriveBreadcrumbPath"]
  key_links:
    - from: "src/components/features/kpi/status-indicator.tsx"
      to: "src/components/ui/badge.tsx"
      via: "Badge component with variants"
      pattern: "Badge.*variant"
    - from: "src/components/features/kpi/goal-tree-breadcrumb.tsx"
      to: "src/components/ui/breadcrumb.tsx"
      via: "Breadcrumb components"
      pattern: "Breadcrumb|BreadcrumbList|BreadcrumbItem"
---

<objective>
Install the shadcn breadcrumb component and create the status indicator and breadcrumb navigation components for the goal tree.

Purpose: Provides accessible status badges that use both color and icons (WCAG 1.4.1 compliance), plus hierarchical breadcrumb navigation from Vision down to the currently selected KPI.

Output: StatusIndicator for status visualization and GoalTreeBreadcrumb for path navigation, both ready for use in the main tree view.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-tree-ui/06-RESEARCH.md

# Existing components
@src/components/ui/badge.tsx
@src/lib/progress/tree.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn breadcrumb component</name>
  <files>src/components/ui/breadcrumb.tsx</files>
  <action>
Install the shadcn/ui Breadcrumb component using the CLI:

```bash
npx shadcn@latest add breadcrumb
```

This will create `src/components/ui/breadcrumb.tsx` with the following exports:
- Breadcrumb (root nav element)
- BreadcrumbList (ol element)
- BreadcrumbItem (li element)
- BreadcrumbLink (anchor element)
- BreadcrumbPage (current page span)
- BreadcrumbSeparator (separator span)
- BreadcrumbEllipsis (for truncated paths)

If prompted for configuration, accept defaults. The component uses @radix-ui/react-slot which is already installed.

After installation, verify the exports exist:
```bash
grep "export" src/components/ui/breadcrumb.tsx | head -10
```
  </action>
  <verify>
File exists and exports correct components:
```bash
test -f src/components/ui/breadcrumb.tsx && grep -c "export" src/components/ui/breadcrumb.tsx
```
  </verify>
  <done>shadcn Breadcrumb component installed with all standard exports (Breadcrumb, BreadcrumbList, BreadcrumbItem, BreadcrumbLink, BreadcrumbPage, BreadcrumbSeparator).</done>
</task>

<task type="auto">
  <name>Task 2: Create StatusIndicator component</name>
  <files>src/components/features/kpi/status-indicator.tsx</files>
  <action>
Create an accessible status indicator that uses both color AND icons (required for WCAG 1.4.1 - information not conveyed by color alone).

Status mapping (align with KPI cache status field):
- `not_started`: gray/secondary, Circle icon, "Not Started"
- `in_progress`: blue/default, Circle icon (filled), "In Progress"
- `on_track`: cyan/success, Check icon, "On Track"
- `at_risk`: amber/warning, AlertTriangle icon, "At Risk"
- `behind`: red/destructive, XCircle icon, "Behind" (map to at_risk styling internally)
- `completed`: cyan/success, Check icon, "Complete"

Export a `statusConfig` record for reuse:
```typescript
export const statusConfig: Record<KpiStatus, {
  icon: React.ComponentType<{ className?: string }>;
  label: string;
  variant: BadgeVariant;
  ariaLabel: string;
}> = { ... };
```

Props:
```typescript
interface StatusIndicatorProps {
  status: string;           // Raw status from KPI
  showLabel?: boolean;      // Show text label (default: false for compact view)
  size?: 'sm' | 'default';  // Badge size variant
  className?: string;
}
```

Implementation:
1. Normalize status string (handle 'behind' -> 'at_risk' mapping, unknown -> 'not_started')
2. Look up config from statusConfig
3. Render Badge with:
   - variant from config
   - size prop passed through
   - aria-label for screen readers
   - Icon (with aria-hidden="true" since aria-label on Badge)
   - Optional label text if showLabel is true
   - Custom className merged with cn()

Import from:
- `lucide-react` for icons: Check, AlertTriangle, XCircle, Circle
- `@/components/ui/badge` for Badge
- `@/lib/utils` for cn()

Use the code example from 06-RESEARCH.md as reference but adapt to use existing Badge variants (success, warning, destructive are already defined in badge.tsx).
  </action>
  <verify>
TypeScript compilation passes:
```bash
npx tsc --noEmit src/components/features/kpi/status-indicator.tsx
```
  </verify>
  <done>StatusIndicator renders accessible badges with icon+color+label, covering all KPI status values.</done>
</task>

<task type="auto">
  <name>Task 3: Create GoalTreeBreadcrumb component</name>
  <files>src/components/features/kpi/goal-tree-breadcrumb.tsx</files>
  <action>
Create the breadcrumb navigation component that shows the path from Vision to the currently selected KPI.

Export a utility function for path derivation:
```typescript
export interface BreadcrumbPathItem {
  id: string;
  label: string;
  level?: string;  // Optional KPI level for styling
}

/**
 * Derives the breadcrumb path from Vision root to the selected node.
 * Returns array starting with Vision, then each ancestor KPI down to selected.
 */
export function deriveBreadcrumbPath(
  selectedId: string | null,
  tree: KpiTreeNode[],
  visionTitle: string
): BreadcrumbPathItem[]
```

Implementation of deriveBreadcrumbPath:
1. Always start with `{ id: 'vision', label: visionTitle }` as first item
2. If selectedId is null, return just the vision item
3. Recursive search through tree to find path:
   ```typescript
   function findPath(nodes: KpiTreeNode[], targetId: string): KpiTreeNode[] | null {
     for (const node of nodes) {
       if (node.id === targetId) return [node];
       if (node.children?.length) {
         const childPath = findPath(node.children, targetId);
         if (childPath) return [node, ...childPath];
       }
     }
     return null;
   }
   ```
4. Map found path to BreadcrumbPathItem array

Component props:
```typescript
interface GoalTreeBreadcrumbProps {
  path: BreadcrumbPathItem[];
  onNavigate: (id: string) => void;  // Called when clicking a breadcrumb item
}
```

Component implementation:
1. Mark as 'use client'
2. Return null if path is empty
3. Use shadcn Breadcrumb components:
   ```tsx
   <Breadcrumb>
     <BreadcrumbList>
       {path.map((item, index) => {
         const isLast = index === path.length - 1;
         return (
           <Fragment key={item.id}>
             <BreadcrumbItem>
               {isLast ? (
                 <BreadcrumbPage>{item.label}</BreadcrumbPage>
               ) : (
                 <BreadcrumbLink
                   href="#"
                   onClick={(e) => {
                     e.preventDefault();
                     onNavigate(item.id);
                   }}
                 >
                   {item.label}
                 </BreadcrumbLink>
               )}
             </BreadcrumbItem>
             {!isLast && <BreadcrumbSeparator />}
           </Fragment>
         );
       })}
     </BreadcrumbList>
   </Breadcrumb>
   ```

Import from:
- `react` for Fragment
- `@/components/ui/breadcrumb` for all Breadcrumb components
- `@/lib/progress` for KpiTreeNode type
  </action>
  <verify>
TypeScript compilation passes:
```bash
npx tsc --noEmit src/components/features/kpi/goal-tree-breadcrumb.tsx
```
  </verify>
  <done>GoalTreeBreadcrumb renders path from Vision to selected KPI, with clickable items for navigation.</done>
</task>

</tasks>

<verification>
1. Breadcrumb component installed:
   ```bash
   test -f src/components/ui/breadcrumb.tsx && echo "Breadcrumb installed"
   ```
2. StatusIndicator exports correct items:
   ```bash
   grep -E "export.*(StatusIndicator|statusConfig)" src/components/features/kpi/status-indicator.tsx
   ```
3. GoalTreeBreadcrumb exports utility and component:
   ```bash
   grep -E "export.*(GoalTreeBreadcrumb|deriveBreadcrumbPath)" src/components/features/kpi/goal-tree-breadcrumb.tsx
   ```
4. All files compile:
   ```bash
   npx tsc --noEmit src/components/features/kpi/status-indicator.tsx src/components/features/kpi/goal-tree-breadcrumb.tsx
   ```
</verification>

<success_criteria>
- shadcn Breadcrumb component is installed and exports all components
- StatusIndicator uses both icon and color for accessibility
- StatusIndicator covers all KPI status values
- GoalTreeBreadcrumb shows path from Vision to selected node
- Clicking breadcrumb items calls onNavigate callback
- All components compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-tree-ui/06-02-SUMMARY.md`
</output>
